<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Category List</title>
    <link rel="stylesheet" href="/admin/assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="/admin/assets/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="/admin/assets/css/style.css">
    <link rel="shortcut icon" href="/admin/assets/images/favicon.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.11.0/Toastify.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.11.0/Toastify.min.js"></script>
    <style>
        .form-control {
    color: #4A90E2; /* Change this to your desired color */
}

/* Change the color of the options */
.form-control option {
    color: #4A90E2; /* Change this to your desired color */
}
    </style>
</head>
<body>
    <div class="container-scroller">
        <%- include('_partials/_sidebar') %>
        <div class="container-fluid page-body-wrapper">
            <nav class="navbar p-0 fixed-top d-flex flex-row">
                
                <%- include('_partials/_navbar') %>
            </nav>
            <div class="main-panel">
                <div class="content-wrapper">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Product List</h4>
                            <button class="btn btn-success mb-3" data-toggle="modal" data-target="#createProductModal">+Add New Product</button>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Sl. No.</th>
                                            <th>Product Name</th>
                                            <th>Category</th>
                                            <th>Price</th>
                                            <th>Stock</th>
                                            <th>Image</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% products.forEach((product, index) => { %>
                                            <tr>
                                                <td><%= index + 1 %></td>
                                                <td><%= product.name %></td>
                                                <!-- Check if category exists before accessing its name -->
                                                <td><%= product.category ? product.category.name : 'No Category' %></td>
                                                <td><%= product.price %></td>
                                                <td><%= product.stock %></td>
                                                <td><img src="http://localhost:3000/images/<%= product.image %>" alt="Product Image" style="width: 50px; height: 50px;"></td>
                                                <td><span class="badge <%= product.isListed ? 'badge-success' : 'badge-danger' %>"><%= product.isListed ? 'Listed' : 'Unlisted' %></span></td>
                                                <td>
                                                    <button class="btn btn-warning edit-button" data-description="<%= product.description %>" data-id="<%= product._id %>" data-name="<%= product.name %>" data-category="<%= product.category ? product.category._id : '' %>" data-price="<%= product.price %>" data-stock="<%= product.stock %>" data-image="<%= product.image1 %>">
                                                        Edit
                                                    </button>
                                                    <% if (product.isListed) { %>
                                                        <form class="list-unlist-form" action="/admin/product/unlist/<%= product._id %>" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to unlist this product?');">
                                                            <button class="btn btn-danger">Unlist</button>
                                                        </form>
                                                    <% } else { %>
                                                        <form class="list-unlist-form" action="/admin/product/list/<%= product._id %>" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to list this product?');">
                                                            <button class="btn btn-info">List</button>
                                                        </form>
                                                    <% } %>
                                                </td>
                                            </tr>
                                        <% }) %>
                                    </tbody>
                                    
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Create Product Modal -->
            <div class="modal fade" id="createProductModal" tabindex="-1" role="dialog" aria-labelledby="createProductModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="createProductModalLabel">Add New Product</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="createProductForm" action="/admin/product/create" method="POST" enctype="multipart/form-data" onsubmit="return validateForm()">
                                <div class="form-group">
                                    <label for="productName">Product Name</label>
                                    <input type="text" class="form-control" id="productName" name="name" required>
                                </div>
                                <div class="form-group">
                                    <label for="productCategory">Category</label>
                                    <select  class="form-control" id="productCategory" name="category" required>
                                        <% categories.forEach(category => { %>
                                            <option value="<%= category._id %>"><%= category.name %></option>
                                        <% }) %>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="productPrice">Price</label>
                                    <input type="number" class="form-control" id="productPrice" name="price" required>
                                </div>
                                <div class="form-group">
                                    <label for="productStock">Stock</label>
                                    <input type="number" class="form-control" id="productStock" name="stock" required>
                                </div>
                                <div class="form-group">
                                    <label for="productDescription">Description (Minimum 30 words)</label>
                                    <textarea class="form-control" id="productDescription" name="description" rows="4" required></textarea>
                                    <small id="descriptionHelp" class="form-text text-muted">Minimum 30 words required.</small>
                                </div>
                                <div class="form-group">
                                    <label>Upload 3 Images</label>
                                    <input type="file" class="form-control-file" id="productImage1" name="image1" accept="image/*" required>
                                    <small id="image1Help" class="form-text text-muted">First image (Only image files are allowed).</small>
                                    
                                    <input type="file" class="form-control-file mt-2" id="productImage2" name="image2" accept="image/*" required>
                                    <small id="image2Help" class="form-text text-muted">Second image (Only image files are allowed).</small>
            
                                    <input type="file" class="form-control-file mt-2" id="productImage3" name="image3" accept="image/*" required>
                                    <small id="image3Help" class="form-text text-muted">Third image (Only image files are allowed).</small>
                                </div>
                                <button type="submit" class="btn btn-primary">Create Product</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Edit Product Modal -->
            <div class="modal fade" id="editProductModal" tabindex="-1" role="dialog" aria-labelledby="editProductModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editProductModalLabel">Edit Product</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="editProductForm" action="/admin/product/edit/" method="POST" enctype="multipart/form-data" onsubmit="return validateEditForm()">
                                <input type="hidden" id="editProductId" name="id"> <!-- Hidden input for product ID -->
                                
                                <div class="form-group">
                                    <label for="editProductName">Product Name</label>
                                    <input type="text" class="form-control" id="editProductName" name="name" required>
                                </div>
                                <div class="form-group">
                                    <label for="editProductCategory">Category</label>
                                    <select class="form-control" id="editProductCategory" name="category" required>
                                        <% categories.forEach(category => { %>
                                            <option value="<%= category._id %>"><%= category.name %></option>
                                        <% }) %>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="editProductPrice">Price</label>
                                    <input type="number" class="form-control" id="editProductPrice" name="price" required>
                                </div>
                                <div class="form-group">
                                    <label for="editProductStock">Stock</label>
                                    <input type="number" class="form-control" id="editProductStock" name="stock" required>
                                </div>
                                <div class="form-group">
                                    <label for="editProductDescription">Description (Minimum 30 words)</label>
                                    <textarea class="form-control" id="editProductDescription" name="description" rows="4" required></textarea>
                                    <small id="descriptionHelp" class="form-text text-muted">Minimum 30 words required.</small>
                                </div>
                                <div class="form-group">
                                    <label>Upload 3 Images (Optional)</label>
                                    <input type="file" class="form-control-file" id="editProductImage1" name="image1" accept="image/*">
                                    <small id="image1Help" class="form-text text-muted">First image (Only image files are allowed).</small>
                                    
                                    <input type="file" class="form-control-file mt-2" id="editProductImage2" name="image2" accept="image/*">
                                    <small id="image2Help" class="form-text text-muted">Second image (Only image files are allowed).</small>
            
                                    <input type="file" class="form-control-file mt-2" id="editProductImage3" name="image3" accept="image/*">
                                    <small id="image3Help" class="form-text text-muted">Third image (Only image files are allowed).</small>
                                </div>
                                <button type="submit" class="btn btn-primary">Update Product</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            

           
    <!-- JS Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/admin/assets/vendors/js/vendor.bundle.base.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script src="/admin/assets/js/off-canvas.js"></script>
    <script src="/admin/assets/js/hoverable-collapse.js"></script>
    <script src="/admin/assets/js/misc.js"></script>
    <script src="/admin/assets/js/settings.js"></script>
    <script src="/admin/assets/js/todolist.js"></script>


    

    <script>
        // Function to validate the form
         // Function to validate the form
    function validateForm() {
        const description = document.getElementById('productDescription').value;

        // Validate description length (at least 30 words)
        const wordCount = description.split(' ').filter(word => word !== '').length;
        if (wordCount < 30) {
            alert('Description must be at least 30 words.');
            return false;
        }

        // Validate images
        const image1 = document.getElementById('productImage1').files[0];
        const image2 = document.getElementById('productImage2').files[0];
        const image3 = document.getElementById('productImage3').files[0];

        if (!image1 || !image2 || !image3) {
            alert('You must upload all 3 images.');
            return false;
        }

        // Validate that only image files are uploaded
        if (!image1.type.startsWith('image/') || !image2.type.startsWith('image/') || !image3.type.startsWith('image/')) {
            alert('Only image files are allowed.');
            return false;
        }

        // If everything is valid
        return true;
    }

    $(document).ready(function () {
        // Event listener for the edit buttons
        $('.edit-button').on('click', function () {
            // Get product details from the data attributes
            const productId = $(this).data('id');
            const productName = $(this).data('name');
            const productCategory = $(this).data('category');
            const productDescription=$(this).data('description')
            const productPrice = $(this).data('price');
            const productStock = $(this).data('stock');
            const productImage = $(this).data('image');

            // Populate the edit modal fields
            $('#editProductId').val(productId);
            $('#editProductName').val(productName);
            $('#editProductCategory').val(productCategory);
           
            $('#editProductPrice').val(productPrice);
            $('#editProductStock').val(productStock);
            $('#editProductDescription').val(productDescription); // Optionally set a default value if needed

            // Show the edit modal
            $('#editProductModal').modal('show');
        });
    });
    </script>
    <script>
   
    </script>
</body>
</html>
